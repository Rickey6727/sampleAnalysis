<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE doma-config>

<project name="doma-gen-decollage" default="gen" basedir=".">

	<property name="javaDestDir" value="src/main/java" />
	<property name="sqlDestDir" value="src/main/resources" />
	<property name="dialectName" value="postgres" />
	<property name="driverClassName" value="org.postgresql.Driver" />
	<property name="user" value="interdev" />
	<property name="password" value="1az3dc4fv" />
	<property name="entityPackageName" value="com.gcrest.atgames.smart.entity" />
	<property name="daoPackageName" value="com.gcrest.atgames.smart.dao" />
	<property name="sqlTestClassName" value="com.gcrest.atgames.smart.SqlTest" />
	<property name="sqlFilePattern" value="META-INF/**/*.sql" />

	<property name="tableNamePattern" value=".*" />
	<property name="sub_package" value="" />

	<path id="classpath">
		<dirset dir="src/main/webapp/WEB-INF/classes" />
		<fileset dir="src/main/webapp/WEB-INF/lib" />
		<fileset dir="lib" />
	</path>

	<taskdef name="gen" classname="org.seasar.doma.extension.gen.task.Gen" classpathref="classpath" loaderref="loader" />
	<taskdef name="genTest" classname="org.seasar.doma.extension.gen.task.GenTest" loaderref="loader" />
	<typedef name="entityConfig" classname="org.seasar.doma.extension.gen.task.EntityConfig" loaderref="loader" />
	<typedef name="daoConfig" classname="org.seasar.doma.extension.gen.task.DaoConfig" loaderref="loader" />
	<typedef name="sqlConfig" classname="org.seasar.doma.extension.gen.task.SqlConfig" loaderref="loader" />
	<typedef name="sqlTestConfig" classname="org.seasar.doma.extension.gen.task.SqlTestConfig" loaderref="loader" />

	<target name="gen">

		<!-- gameのテーブルのDao、Entity生成 -->
		<antcall target="gen_sub" inheritall="true">
			<param name="url" value="jdbc:postgresql://172.26.1.53:5432/game" />
			<param name="sub_package" value=".game" />
			<param name="tableNamePattern" value="(t_sheep_book)" />
		</antcall>
	</target>

	<target name="gen_sub">
		<gen
			tableNamePattern="${tableNamePattern}"
			dialectName="${dialectName}"
			driverClassName="${driverClassName}"
			url="${url}"
			user="${user}"
			password="${password}"
			templatePrimaryDir="daoGenerateSetting/template">

			<entityConfig
				destdir="${javaDestDir}"
				packageName="${entityPackageName}${sub_package}"
				entityPropertyClassNamesFile="daoGenerateSetting/entityPropertyClassNames.properties" />

			<daoConfig
				destdir="${javaDestDir}"
				packageName="${daoPackageName}${sub_package}" />

			<sqlConfig
				destdir="${sqlDestDir}" />
		</gen>
	</target>


	<target name="genTest">
		<genTest dialectName="${dialectName}" driverClassName="${driverClassName}" url="${url}" user="${user}" password="${password}">
			<sqlTestConfig destdir="${javaDestDir}" testClassName="${sqlTestClassName}">
				<fileset dir="${sqlDestDir}">
					<include name="${sqlFilePattern}" />
				</fileset>
			</sqlTestConfig>
		</genTest>
	</target>

</project>
